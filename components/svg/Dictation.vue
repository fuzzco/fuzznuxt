<template>
    <svg
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        viewBox="0 0 701.36 387.65"
        class="svg-dictation"
    >
        <defs>
            <clipPath id="a">
                <path
                    d="M626.81,241.06H454a7.92,7.92,0,0,1-7.92-7.91V113.4H626.81Z"
                    fill="none"
                />
            </clipPath>
            <linearGradient
                id="window-gradient"
                gradientTransform="rotate(-55, 0, 0.7)"
            >
                <stop offset="0%" stop-color="#fff" />
                <stop offset="50%" stop-color="#E5F2E1" />
                <stop offset="100%" stop-color="#8FFCDD" />
            </linearGradient>
        </defs>
        <path
            ref="midRightLine"
            class="mid-right-line"
            d="M622.08,182.55a63.77,63.77,0,1,1,0,127.54"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <path
            ref="farRightLine"
            class="far-right-line"
            d="M621.08,171.77a76.56,76.56,0,0,1,76.56,76.55"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <path
            class="winding-connector"
            ref="windingConnector"
            d="M62.5,262.9h71.58a8,8,0,0,1,8,8v24.59a8.47,8.47,0,0,0,8.46,8.47H151a8.47,8.47,0,0,0,8.46-8.47V82a8.46,8.46,0,0,1,8.46-8.46h.34A8.46,8.46,0,0,1,176.73,82V329.68a8.47,8.47,0,0,0,8.47,8.47h0a8.47,8.47,0,0,0,8.46-8.47V35.27a8.47,8.47,0,0,1,8.47-8.47h.22a8.47,8.47,0,0,1,8.46,8.47v210.6a8.47,8.47,0,0,0,8.47,8.47h.09a8.47,8.47,0,0,0,8.47-8.47V181.44a8,8,0,0,1,8-8H493.4"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <path
            d="M199.13,387h-27a8.73,8.73,0,0,1-8.73-8.73h0a8.73,8.73,0,0,1,8.73-8.73h16.3a14.1,14.1,0,0,1,14.1,14.11h0A3.35,3.35,0,0,1,199.13,387Z"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <path
            d="M117,355.23c-2.63-100.62-31.54-155.58-63.81-155.58C17.57,199.65-10.48,298.28,3.8,387H173.13V366.57Z"
            fill="#8ffcdd"
            transform="translate(0, 1)"
        />
        <g>
            <path
                d="M101.77,145.82c0,10.78,7.89,22.85,7.89,22.85a3.44,3.44,0,0,1-2.29,4.43l-2.74.8a3.14,3.14,0,0,0-2.24,3.53l1.7,10.39a10.15,10.15,0,0,1-10,11.79l-21.32,0L33,192.13l10.14-53.76Z"
                fill="none"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
            <path
                d="M86.74,169.79l-1-8.48s38.82-3.65,26.06-29.38c-8.63-17.42-22.91-14.06-31.24-10.07a21.31,21.31,0,0,1-14,1.59c-11.33-2.63-36-3.66-43,22.37-8,29.89,4.39,29.78,1,45.49s-12,25.6-4.43,33.6,24.83,7.27,34.5,14.39c9.26,6.83,16.18,26.29,16.18,26.29s17.13-27.89,15-51.57c-1.43-15.86-2.68-22-9.56-29.2-6.55-6.88-12-11.48-6.53-17.2,4-4.13,11.59,2.08,13.71,4a2.07,2.07,0,0,0,1.36.51h0A2,2,0,0,0,86.74,169.79Z"
                fill="#2e5f62"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
        </g>
        <path
            d="M623.3,193.55A52.57,52.57,0,0,1,675.87,247c-.48,28.82-24.6,51.67-53.43,51.67H380.13a7,7,0,0,0-5.61,2.8l-62,82.73A7,7,0,0,1,307,387H3.8"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
            ref="longLine"
            class="long-line"
        />
        <path
            d="M44.24,274.08a279.56,279.56,0,0,0-6.42,64.56L117,355.23"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <line
            x1="160.48"
            y1="0.63"
            x2="160.48"
            y2="0.63"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <circle
            cx="572.87"
            cy="176.62"
            r="1.75"
            fill="#2e5f62"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <rect
            x="476.6"
            y="204.16"
            width="3.53"
            height="3.53"
            transform="translate(285.72 -277.94) rotate(45)"
            fill="#2e5f62"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <circle
            cx="462.81"
            cy="187.91"
            r="3.07"
            fill="#fff"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <g>
            <rect
                x="446"
                y="111"
                width="181"
                height="180"
                fill="url(#window-gradient)"
            />
            <g>
                <g>
                    <g>
                        <path
                            d="M455.91,127.29v2.26H458v-2.26h1v5.47h-1v-2.28h-2.06v2.28h-1v-5.47Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M460.78,127.09a.67.67,0,1,1,0,1.34.67.67,0,1,1,0-1.34Zm.49,5.67h-1v-3.88h1Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M463.91,128.77a2.65,2.65,0,0,1,2,.89l-.66.58a1.69,1.69,0,0,0-1.28-.67c-.39,0-.57.16-.57.37s.19.32.56.38l.47.08c.84.14,1.51.43,1.51,1.19s-.69,1.28-1.64,1.28a2.47,2.47,0,0,1-2.13-1.13l.77-.47a1.48,1.48,0,0,0,1.34.8c.45,0,.7-.18.7-.41s-.2-.35-.59-.41l-.47-.08c-.9-.15-1.48-.48-1.48-1.2S463,128.77,463.91,128.77Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M467.55,128.88v-1.2h1v1.2h1.06v.83h-1.06v2c0,.15.07.23.22.23h.62v.83h-1.06a.74.74,0,0,1-.77-.75v-2.3h-1v-.83Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M472.4,128.77a2.05,2.05,0,1,1-2,2A2,2,0,0,1,472.4,128.77Zm0,3.22a1.18,1.18,0,1,0-1-1.17A1.05,1.05,0,0,0,472.4,132Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M476.43,129.45h.11a.88.88,0,0,1,1-.58h.38v.86h-.58a.77.77,0,0,0-.86.81v2.22h-1v-3.88h1Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M482.84,128.88l-2.12,5.44h-1.07l.55-1.31-1.61-4.13h1.06l1,2.78h.09l1-2.78Z"
                            fill="#2e5f62"
                        />
                    </g>
                    <rect
                        x="454.43"
                        y="137.66"
                        width="164.08"
                        height="32.42"
                        fill="#fff"
                    />
                </g>
                <g>
                    <g>
                        <path
                            d="M456.71,182.63l1.25,4.5h.09v-4.5h1v5.47h-1.82L456,183.6h-.1v4.5h-1v-5.47Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M462.16,184.11a2.05,2.05,0,1,1-2,2A2,2,0,0,1,462.16,184.11Zm0,3.22a1.18,1.18,0,1,0-1.05-1.17A1.05,1.05,0,0,0,462.16,187.33Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M465.76,184.22V183h1v1.2h1.06v.83h-1.06v2c0,.16.08.24.22.24h.62v.83h-1.06a.74.74,0,0,1-.77-.75v-2.3h-1v-.83Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M470.53,184.11a1.82,1.82,0,0,1,1.88,1.95v.37h-2.82a1,1,0,0,0,1,.93,1,1,0,0,0,1-.58l.8.47a1.91,1.91,0,0,1-1.75,1,2,2,0,0,1-2-2.08A1.92,1.92,0,0,1,470.53,184.11Zm.88,1.67a.84.84,0,0,0-.89-.82.85.85,0,0,0-.92.82Z"
                            fill="#2e5f62"
                        />
                        <path
                            d="M474.79,184.11a2.72,2.72,0,0,1,2,.88l-.67.59a1.64,1.64,0,0,0-1.28-.67c-.39,0-.57.15-.57.37s.2.32.57.38l.46.08c.85.14,1.51.43,1.51,1.19s-.69,1.28-1.64,1.28a2.45,2.45,0,0,1-2.12-1.13l.77-.48a1.46,1.46,0,0,0,1.34.81c.45,0,.7-.18.7-.42s-.2-.34-.59-.4l-.47-.08c-.91-.15-1.48-.48-1.48-1.2S473.9,184.11,474.79,184.11Z"
                            fill="#2e5f62"
                        />
                    </g>
                    <rect
                        x="454.43"
                        y="193"
                        width="164.08"
                        height="32.42"
                        fill="#fff"
                    />
                </g>
            </g>
            <path
                d="M450.89,106.72H622a4.77,4.77,0,0,1,4.77,4.77v1.9a0,0,0,0,1,0,0H446.12a0,0,0,0,1,0,0v-1.9a4.77,4.77,0,0,1,4.77-4.77Z"
                fill="#2e5f62"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
        </g>

        <!-- Checkbox -->
        <g ref="checkbox">
            <circle cx="622.08" cy="246.32" r="43.68" fill="#2e5f62" />
            <polygon
                points="615.14 273.97 598.73 247.59 604.09 244.26 617.44 265.74 639.74 218.67 645.43 221.37 620.67 273.66 615.14 273.97"
                fill="#fff"
            />
        </g>

        <!-- Silhouette -->
        <g class="silhouette" ref="silhouette">
            <path
                d="M397.72,135.57a9,9,0,0,0-4.58-3.74c-1.71-.66-5.11-.46-6.81-.09-1.19.27-21,1.26-26.12.57-3.47-.47-15.3-1.63-19.6-3.23q-1.67-.62-3.36-1.11a8.36,8.36,0,0,1-5.61-5.59c0-.1,1.32-1.48,1.39-1.57a5.73,5.73,0,0,0,1.28-3.21l.46-6.09a6.23,6.23,0,0,0-5.93-6.69h-.43a6.24,6.24,0,0,0-5.94,6.69l.46,6.09a5.67,5.67,0,0,0,1.29,3.21c.06.09,1.39,1.47,1.39,1.57a8.38,8.38,0,0,1-5.54,5.56c-1.12.35-2.33.74-3.44,1.14-4.31,1.6-16.13,2.76-19.6,3.23-5.15.69-24.92-.3-26.12-.57-1.69-.37-5.09-.57-6.8.09a9.08,9.08,0,0,0-4.59,3.74,1.26,1.26,0,0,0,1.3,1.89c3.62-.62,10.34-1.78,10.36-1.77.71.09,9.5,2.61,15.22,3.11,3.68.32,17,.14,23,0a4.4,4.4,0,0,1,4.21,2.89,69.34,69.34,0,0,1,3.24,11.52,22.27,22.27,0,0,1,.37,5.07l-.09,1.54-.84,6.92c-.89,4.95-2.38,15-1.34,20,1.22,5.8,2.54,14.19,2.94,16.74,0,.51,0,1,0,1.5-.39,2.24-1.47,9-.67,12.11,1,3.7,3.22,12.05,3.22,13.81s-.65,7.23-2.25,8.36a17.73,17.73,0,0,0-3.34,3.63.44.44,0,0,0-.06.16c-.05.31,0,1.27,2.27,1.67a10.84,10.84,0,0,0,4.24,0,.35.35,0,0,0,.17-.09,6.87,6.87,0,0,0,1.7-2.5c.48-1.45,2-2.92,2.56-3.7.87-1.16,1-5,0-6.58s.81-10.6,1.13-14c.29-3-1.12-7.67-1.4-8.53a.41.41,0,0,1,0-.29A38.38,38.38,0,0,0,328,195.9c-.13-5.36,0-14.83,0-18.17a.62.62,0,0,1,.62-.62h0a.63.63,0,0,1,.63.62c0,3.34.12,12.81,0,18.17a38.05,38.05,0,0,0,2.52,13.19.45.45,0,0,1,0,.28c-.27.87-1.69,5.49-1.4,8.54.33,3.37,2.09,12.36,1.13,14s-.87,5.42,0,6.58c.57.78,2.09,2.25,2.57,3.7a6.76,6.76,0,0,0,1.69,2.5.4.4,0,0,0,.17.09,10.86,10.86,0,0,0,4.24,0c2.27-.4,2.32-1.36,2.27-1.67a.44.44,0,0,0-.06-.16,17.61,17.61,0,0,0-3.33-3.63c-1.61-1.13-2.25-6.59-2.25-8.36S339,220.8,340,217.1c.8-3.06-.28-9.87-.67-12.11,0-.51,0-1,0-1.5.4-2.55,1.73-10.94,2.94-16.74,1.05-5-.44-15-1.34-20-.28-2.31-.55-4.61-.83-6.92l-.1-1.54a21.12,21.12,0,0,1,.19-3.89,65.84,65.84,0,0,1,3.42-12.7,4.41,4.41,0,0,1,4.21-2.89c6.07.11,19.37.29,23,0,5.72-.5,14.52-3,15.22-3.11,0,0,6.74,1.15,10.36,1.77A1.26,1.26,0,0,0,397.72,135.57Z"
                fill="#8ffcdd"
            />
            <g>
                <g ref="smallCheck">
                    <circle cx="309.39" cy="205.65" r="10.91" fill="#2e5f62" />
                    <polygon
                        points="307.65 212.56 303.56 205.97 304.89 205.14 308.23 210.5 313.8 198.74 315.22 199.42 309.04 212.48 307.65 212.56"
                        fill="#fff"
                    />
                </g>
                <g ref="smallX">
                    <circle cx="346.54" cy="173.87" r="10.91" fill="#2e5f62" />
                    <polygon
                        points="352.37 169.03 351.42 168.08 346.55 172.96 341.67 168.08 340.72 169.03 345.6 173.91 340.72 178.79 341.67 179.73 346.55 174.85 351.42 179.73 352.37 178.79 347.49 173.91 352.37 169.03"
                        fill="#fff"
                    />
                </g>
            </g>
        </g>
        <path
            d="M116.43,341.4c-1.87-16.38-3.36-17.82-9.1-22.63-2.77-2.32-4.79-6.52-5.44-11.43-1.25-9.35-3.57-24.27-6.52-31.49C89,260.24,76.53,230.34,76.53,230.34"
            fill="none"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
        />
        <g class="accent-top" ref="accentTop">
            <path
                d="M403.13,288.45H375.07a7,7,0,0,0-5.6,2.81l-44.23,59"
                fill="none"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
            <circle
                cx="325.24"
                cy="350.28"
                r="3.1"
                fill="#2e5f62"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
            <circle
                cx="403.13"
                cy="288.45"
                r="3.1"
                fill="#fff"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
        </g>
        <g class="accent-bottom" ref="accentBottom">
            <path
                d="M440.15,308.45H385.24a7,7,0,0,0-5.6,2.81l-50.23,67"
                fill="none"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />

            <circle
                cx="440.15"
                cy="308.45"
                r="3.1"
                fill="#2e5f62"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
            <circle
                cx="329.41"
                cy="378.28"
                r="3.1"
                fill="#fff"
                stroke="#2e5f62"
                stroke-miterlimit="10"
                stroke-width="1.25"
            />
        </g>
        <circle
            cx="622.08"
            cy="310.09"
            r="3.1"
            fill="#fff"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
            ref="midRightDot"
        />
        <circle
            cx="697.64"
            cy="248.32"
            r="3.1"
            fill="#2e5f62"
            stroke="#2e5f62"
            stroke-miterlimit="10"
            stroke-width="1.25"
            ref="farRightDot"
        />
    </svg>
</template>

<script>
import { timeline, styler, easing } from 'popmotion'
const { backOut } = easing

let animation

export default {
    props: {
        progress: {
            type: Number,
            default: 0
        }
    },
    async mounted() {
        await this.$nextTick()
        this.runAnimation()
    },
    methods: {
        runAnimation() {
            const stylers = {
                windingConnector: styler(this.$refs.windingConnector),
                silhouette: styler(this.$refs.silhouette),
                smallCheck: styler(this.$refs.smallCheck),
                smallX: styler(this.$refs.smallX),
                checkbox: styler(this.$refs.checkbox),
                midRightDot: styler(this.$refs.midRightDot),
                farRightDot: styler(this.$refs.farRightDot),
                farRightLine: styler(this.$refs.farRightLine),
                midRightLine: styler(this.$refs.midRightLine),
                longLine: styler(this.$refs.longLine),
                accentTop: styler(this.$refs.accentTop),
                accentBottom: styler(this.$refs.accentBottom)
            }

            const speed = 1

            animation = timeline(
                [
                    // Slide 1
                    {
                        track: 'windingConnector',
                        from: {
                            'stroke-dashoffset': 1560
                        },
                        to: {
                            'stroke-dashoffset': 0
                        },
                        duration: 61
                    },
                    '-50',
                    {
                        track: 'silhouette',
                        from: { opacity: 0, y: 20 },
                        to: { opacity: 1, y: 0 },
                        duration: 30
                    },
                    '-20',

                    {
                        track: 'smallCheck',
                        from: { opacity: 0, y: 20 },
                        to: { opacity: 1, y: 0 },
                        duration: 30
                    },
                    '-20',
                    {
                        track: 'smallX',
                        from: { opacity: 0, y: 20 },
                        to: { opacity: 1, y: 0 },
                        duration: 30
                    },

                    // Slide 2
                    {
                        track: 'checkbox',
                        from: { scale: 0 },
                        to: { scale: 1 },
                        duration: 92,
                        ease: backOut
                    },

                    // Slide 3
                    {
                        track: 'midRightLine',
                        from: { 'stroke-dashoffset': 200 },
                        to: { 'stroke-dashoffset': 0 },
                        duration: 60
                    },
                    {
                        track: 'midRightDot',
                        from: { opacity: 0 },
                        to: { opacity: 1 },
                        duration: 30
                    },
                    '-80',
                    {
                        track: 'farRightLine',
                        from: { 'stroke-dashoffset': 121 },
                        to: { 'stroke-dashoffset': 0 },
                        duration: 60
                    },
                    {
                        track: 'farRightDot',
                        from: { opacity: 0 },
                        to: { opacity: 1 },
                        duration: 30
                    },
                    '-80',
                    {
                        track: 'longLine',
                        from: { 'stroke-dashoffset': 900 },
                        to: { 'stroke-dashoffset': 0 },
                        duration: 100
                    },
                    '-60',
                    [
                        {
                            track: 'accentTop',
                            from: { opacity: 0 },
                            to: { opacity: 1 },
                            duration: 40
                        },
                        {
                            track: 'accentBottom',
                            from: { opacity: 0 },
                            to: { opacity: 1 },
                            duration: 40
                        }
                    ]
                ],
                {
                    ease: t => t
                }
            ).start(vals => {
                Object.keys(vals).forEach(key => stylers[key].set(vals[key]))
            })

            animation.seek(0)
            animation.pause()
        }
    },
    watch: {
        progress(newVal) {
            animation.seek(newVal)
        }
    }
}
</script>

<style lang="scss">
.svg-dictation {
    .winding-connector {
        stroke-dasharray: 1600px;
    }
    .mid-right-line {
        stroke-dasharray: 200px;
    }
    .far-right-line {
        stroke-dasharray: 121px;
    }
    .long-line {
        stroke-dasharray: 900px;
    }
}
</style>
